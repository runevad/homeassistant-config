- id: car_heater_start
  alias: "Engine heater activate"
  trigger:
    platform: template
    value_template: '{{ states.sensor.heater_activationtime.state == states.sensor.time.state }}'
  condition:
    condition: and
    conditions:
      - condition: state
        # replace entity_id below with your own tracker (group or single)
        entity_id: group.household
        # if your home zone is called home
        state: 'home'
      - condition: or
        # Below checks if it's a workday or not
        conditions:
          - condition: state
            entity_id: input_boolean.workdays_only
            state: 'off'
          - condition: and
            conditions:
              - condition: state
                entity_id: binary_sensor.workday
                state: 'on'
              - condition: state
                entity_id: input_boolean.workdays_only
                state: 'on'
  # If the above conditions are fulfilled, ie. you are home and it's a workday
  # then activate the heater on your selected time
  action:
    - service: switch.turn_on
      entity_id: switch.car_heater_136

# Automation 2 turns off the car heater at the set delay.
- id: car_heater_shut_down
  alias: "Engine heater deactivate"
  trigger:
    platform: template
    value_template: '{{ states.sensor.heater_departuretime.state == states.sensor.time.state }}'
  action:
    - delay:
        minutes: "{{ states('input_number.heater_delay') | int }}"
    - service: switch.turn_off
      entity_id: switch.car_heater_136
