#------
# IKEA modes
#white:
#245, 250, 246
#---
#everyday:
#241, 224, 181
#---
#nightmode:
#239, 210, 117
#color_temp: 454
#---

################################
## Lights
################################
- id: turn_on_lights_when_away
  alias: turn_on_lights_when_away
  initial_state: 'on'
  condition:
    - condition: state
      entity_id: input_select.cottage_status
      state: 'Away'
  trigger:
    - platform: sun
      event: sunset
  action:
    - service: light.turn_on
      data:
        brightness: 200
        color_temp: 454
        transition: 1800
      entity_id: group.all_lights

- id: lights_on_pre_kids_bedtime
  alias: lights_on_pre_kids_bedtime
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.cottage_update
          state: 'on'
        - condition: state
          entity_id: group.household
          state: 'home'
        - condition: time
          after: '12:00:00'
          before: '19:30:00'
  trigger:
    - platform: sun
      event: sunset
    - platform: numeric_state
      entity_id: sensor.lux_allrum_22
      below: '30'
  action:
    - service: light.turn_on
      data:
        brightness: 180
        color_temp: 454
        transition: 60
      entity_id: group.all_lights

- id: lights_on_evening
  alias: lights_on_evening
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.cottage_update
          state: 'on'
        - condition: state
          entity_id: group.household
          state: 'home'
        - condition: time
          after: '19:30:00'
          before: '22:00:00'
  trigger:
    - platform: sun
      event: sunset
    - platform: numeric_state
      entity_id: sensor.lux_allrum_22
      below: '30'
  action:
    - service: light.turn_on
      data:
        brightness: 180
        color_temp: 454
        transition: 60
      entity_id:
        - light.fonsterlampor_vardagsrum_81
        - light.fonsterlampor_uppe1_115
        - light.stora_fonstret_sovrum_vuxna_e14

- id: morning_lights_weekday
  alias: morning_lights_weekday
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.cottage_update
          state: 'on'
        - condition: state
          entity_id: group.household
          state: 'home'
        - condition: state
          entity_id: light.fonsterlampor_vardagsrum_81
          state: 'off'
        - condition: time
          after: '05:30:00'
          before: '08:30:00'
        - condition: state
          entity_id: binary_sensor.workday
          state: 'on'
        - condition: or
          conditions:
            - condition: state
              entity_id: sun.sun
              state: 'below_horizon'
            - condition: numeric_state
              entity_id: sensor.lux_allrum_22
              below: '30'
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_allrum_20
      to: 'on'
  action:
    - service: light.turn_on
      data:
        brightness: 255
        color_temp: 454
      entity_id: light.fonsterlampor_vardagsrum_81

- id: morning_lights_weekend
  alias: morning_lights_weekend
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.cottage_update
          state: 'on'
        - condition: state
          entity_id: group.household
          state: 'home'
        - condition: state
          entity_id: light.fonsterlampor_uppe1_115
          state: 'off'
        - condition: state
          entity_id: light.fonsterlampor_vardagsrum_81
          state: 'off'
        - condition: time
          after: '07:30:00'
          before: '09:00:00'
        - condition: state
          entity_id: binary_sensor.workday
          state: 'off'
        - condition: or
          conditions:
            - condition: state
              entity_id: sun.sun
              state: 'below_horizon'
            - condition: numeric_state
              entity_id: sensor.lux_allrum_22
              below: '30'
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_allrum_20
      to: 'on'
  action:
    - service: light.turn_on
      data:
        brightness: 255
        color_temp: 454
      entity_id:
        - light.fonsterlampor_vardagsrum_81
        - light.fonsterlampor_uppe1_115

- id: lights_on_up_night_motion
  alias: lights_on_up_night_motion
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: time
          after: '23:00:00'
        - condition: state
          entity_id: light.fonsterlampor_uppe1_115
          state: 'off'
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_allrum_20
      to: 'on'
  action:
    - service: light.turn_on
      entity_id: light.fonsterlampor_uppe1_115
    - delay: 00:04:00
    - service: light.turn_off
      entity_id: light.fonsterlampor_uppe1_115

- id: lights_on_down_night_motion
  alias: lights_on_down_night_motion
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_select.cottage_status
          state: 'Night'
        - condition: state
          entity_id: light.fonsterlampor_vardagsrum_81
          state: 'off'
  trigger:
    - platform: state
      entity_id: binary_sensor.motion_hall_11
      to: 'on'
  action:
    - service: light.turn_on
      entity_id: light.fonsterlampor_vardagsrum_81
    - delay: 00:04:00
    - service: light.turn_off
      entity_id: light.fonsterlampor_vardagsrum_81

- id: lights_off_when_high_lux
  alias: lights_off_when_high_lux
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.cottage_update
          state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.lux_hall_13
      above: '30'
    - platform: numeric_state
      entity_id: sensor.lux_allrum_22
      above: '30'
  action:
    - service: light.turn_off
      entity_id: group.all_lights

- id: wake_up_lights_weekday
  alias: Wake up light weekdays
  initial_state: 'on'
  condition:
    - condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.cottage_update
          state: 'on'
        - condition: state
          entity_id: binary_sensor.workday
          state: 'on'
  trigger:
    - platform: time
      at: 06:45
  action:
    - service: light.turn_on
      data:
        brightness: 255
        color_temp: 454
        transition: 18000
      entity_id:
        - light.tradfri_bulb_e27_cws_opal_600lm
        - light.lilla_fonstret_ingrid
