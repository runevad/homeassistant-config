#Alarm
#####
sonos_doorbell:
  alias: "Sonos doorbell"
  sequence:
    - service: sonos.snapshot
      entity_id: media_player.kokvardagsrum
    - service: media_player.volume_set
      entity_id: media_player.kokvardagsrum
      data:
        volume_level: 0.6
    - service: media_player.play_media
      entity_id: media_player.kokvardagsrum
      data:
        media_content_id: !secret mp3_doorbell
        media_content_type: 'music'
    - delay: '00:00:15'
    - service: sonos.restore
      entity_id: media_player.kokvardagsrum

sonos_fire_alarm:
  alias: "Sonos fire alarm"
  sequence:
    - service: sonos.snapshot
      entity_id: media_player.kokvardagsrum
    - service: media_player.volume_set
      entity_id: media_player.kokvardagsrum
      data:
        volume_level: 0.8
    - service: media_player.play_media
      entity_id: media_player.kokvardagsrum
      data:
        media_content_id: !secret mp3_fire_alarm
        media_content_type: 'music'
    - delay: '00:00:40'
    - service: sonos.restore
      entity_id: media_player.kokvardagsrum

sonos_alarm:
  alias: "Sonos alarm"
  sequence:
    - service: sonos.snapshot
      entity_id: media_player.kokvardagsrum
    - service: media_player.volume_set
      entity_id: media_player.kokvardagsrum
      data:
        volume_level: 0.8
    - service: media_player.play_media
      entity_id: media_player.kokvardagsrum
      data:
        media_content_id: !secret mp3_alarm
        media_content_type: 'music'
    - delay: '00:03:00'
    - service: sonos.restore
      entity_id: media_player.kokvardagsrum

### Setting home modes
#####################
cottage_home:
  alias: "Cottage Home"
  sequence:
    - service: input_select.select_option
      data:
        entity_id: input_select.cottage_status
        option: 'Home'
    - service: switch.turn_on
      data:
        entity_id: switch.vvc_135
    - service: homeassistant.turn_off
      data:
        entity_id:
          - group.door_units
          - group.motion_units

cottage_away:
  alias: "Cottage Away"
  sequence:
    - service: input_select.select_option
      data:
        entity_id: input_select.cottage_status
        option: 'Away'
    - service: switch.turn_off
      data:
        entity_id: switch.vvc_135
    - service: homeassistant.turn_on
      data:
        entity_id:
          - group.door_units
          - group.motion_units
    - service: light.turn_off
      data:
        entity_id: group.all_lights
    - service: media_player.turn_off

cottage_standby:
  alias: "Cottage Standby"
  sequence:
    - service: input_select.select_option
      data:
        entity_id: input_select.cottage_status
        option: 'Standby'
    - service: switch.turn_off
      data:
        entity_id: switch.vvc_135
    - service: homeassistant.turn_off
      data:
        entity_id:
          - group.motion_units
          - group.door_units

cottage_night:
  alias: "Cottage Night"
  sequence:
    - service: input_select.select_option
      data:
        entity_id: input_select.cottage_status
        option: 'Night'
    - service: switch.turn_off
      data:
        entity_id:
          - switch.vvc_135
          - switch.extra_hot_water
    - service: light.turn_off
      data:
        entity_id: group.window_lights
    - service: homeassistant.turn_on
      data:
        entity_id: group.door_units

restart_hass:
  alias: "Restart Home Assistant"
  sequence:
    - service: shell_command.restart_hass


## Other
########################
extra_hot_water:
  alias: "Extra varmvatten 2h"
  sequence:
    - service: switch.turn_on
      data:
        entity_id: switch.extra_hot_water
    - delay: '02:00:00'
    - service: switch.turn_off
      data:
        entity_id: switch.extra_hot_water

car_heater:
  alias: "Motorvärmare start 2h"
  sequence:
    - service: switch.turn_on
      data:
        entity_id: switch.car_heater_149
    - delay: '02:30:00' #30 min "overrun time"
    - service: switch.turn_off
      data:
        entity_id: switch.car_heater_149

#Sonos
sonos_say:
  alias: "Sonos TTS script"
  sequence:
    - service: sonos.snapshot
      data_template:
        entity_id: "{{ sonos_entity|default('media_player.kokvardagsrum') }}"
    - service: sonos.unjoin
      data_template:
        entity_id: "{{ sonos_entity|default('media_player.kokvardagsrum') }}"
    - service: media_player.volume_set
      data_template:
        entity_id: "{{ sonos_entity|default('media_player.kokvardagsrum') }}"
        volume_level: "{{ volume|default(0.4) }}"
    - service: tts.google_say
      data_template:
        entity_id: "{{ sonos_entity|default('media_player.kokvardagsrum') }}"
        message: "{{ message }}"
    - delay: "{{ delay|default('00:00:00') }}"
    - wait_template: "{{ is_state(sonos_entity|default('media_player.kokvardagsrum'), 'playing') }}"
      timeout: '00:00:10'
    - service: sonos.restore
      data_template:
        entity_id: "{{ sonos_entity|default('media_player.kokvardagsrum') }}"

#### Triggered from IFTTT automation
dishwasher_done:
  alias: "Diskmaskinen klar"
  sequence:
    - condition: time
      after: '08:00:00'
      before: '21:00:00'
    - service: notify.ios_lars_iphone
      data:
        title: "Diskmaskinen klar!"
        message: "..."
        data:
          push:
            badge:
            category: "notis"
    - service: script.sonos_say
      data_template:
        sonos_entity: media_player.kokvardagsrum
        volume: 0.55
        delay: '00:00:15'
        message: 'Hej Hej Hej, diskmaskinen har körts klart och är redo för utplockning'

###  "light-scenes"
kerstin_night:
  alias: "Kerstins sovrum night mode"
  sequence:
    - service: light.turn_off
      entity_id:
        - light.stora_fonstret_kerstin_e14
        - light.stora_fonstret_kerstin
        - light.sanglampa_kerstin
    - delay: '00:00:01'
    - service: light.turn_on
      data:
        brightness: 1
        rgb_color: [255, 0, 0]
        # transition: 2
      entity_id:
        - light.tradfri_bulb_e27_cws_opal_600lm

ingrid_night:
  alias: "Ingrid sovrum night mode"
  sequence:
    - service: light.turn_off
      entity_id:
        - light.stora_fonstret_ingrid_e14
        - light.stora_fonstret_ingrid
        - light.sanglampa_ingrid
    - delay: '00:00:01'
    - service: light.turn_on
      data:
        brightness: 1
        rgb_color: [255,0,0]
        # transition: 2
      entity_id:
        - light.lilla_fonstret_ingrid

kerstin_reading:
  alias: "Läslampa Kerstin"
  sequence:
    - service: light.turn_on
      data:
        brightness: 200
      entity_id:
        - light.sanglampa_kerstin
    - delay: '00:00:01'
    - service: light.turn_on
      data:
        brightness: 1
        rgb_color: [255, 0, 0]
        # transition: 2
      entity_id:
        - light.tradfri_bulb_e27_cws_opal_600lm
    - delay: '00:00:01'
    - service: light.turn_off
      entity_id:
        - light.stora_fonstret_kerstin_e14
        - light.stora_fonstret_kerstin

ingrid_reading:
  alias: "Läslampa Ingrid"
  sequence:
    - service: light.turn_on
      data:
        brightness: 200
      entity_id:
        - light.sanglampa_ingrid
    - delay: '00:00:01'
    - service: light.turn_on
      data:
        brightness: 1
        rgb_color: [255, 0, 0]
        # transition: 2
      entity_id:
        - light.lilla_fonstret_ingrid
    - delay: '00:00:01'
    - service: light.turn_off
      entity_id:
        - light.stora_fonstret_ingrid
        - light.stora_fonstret_ingrid_e14
